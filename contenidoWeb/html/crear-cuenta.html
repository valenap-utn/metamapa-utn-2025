<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear cuenta</title>

    <link rel="icon" href="../components/logo-ico.png" >

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Lexend:wght@100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">


    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link href="../css/mis-estilos/styles-crear-cuenta.css" rel="stylesheet">

    <!-- Iconos -->
    <script src="https://kit.fontawesome.com/d4dda767ac.js" crossorigin="anonymous"></script>
</head>
<body>
    <section class="mm-form-wrap">
        <div class="mm-card">
            <h1 class="mm-form-title">Crear cuenta</h1>
            <p class="mm-form-sub">Completá tus datos para empezar a utilizar MetaMapa</p>

            <form id="form-usuario" class="mm-form" novalidate>
                <div class="mm-grid">
                    <div class="mm-field">
                        <label for="nombre" class="mm-label">Nombre</label>
                        <input id="nombre" name="nombre" type="text" class="mm-input" placeholder="Tu nombre" required aria-label="Ingresar nombre">
                    </div>

                    <div class="mm-field">
                        <label for="apellido" class="mm-label">Apellido</label>
                        <input id="apellido" name="apellido" type="text" class="mm-input" placeholder="Tu apellido" required aria-label="Ingresar apellido">
                    </div>

                    <div class="mm-field">
                        <label for="fechaDeNacimiento" class="mm-label">Fecha de nacimiento</label>
                        <input id="fechaDeNacimiento" name="fechaDeNacimiento" type="date" class="mm-input" required>
                    </div>

                    <div class="mm-field">
                        <label for="rolId" class="mm-label">Rol</label>
                        <select id="rolId" name="rolId" class="mm-input" required aria-label="Seleccionar rol">
                            <option value="" disabled selected>Seleccioná un rol…</option>
                            <option value="1">USUARIO</option>
                            <option value="2">ADMIN</option>
                        </select>
                    </div>
                </div>

                <div class="mm-actions">
                    <a href="./iniciar-sesion.html" class="mm-btn mm-btn-ghost"><span class="arrow"><i class="fa-solid fa-arrow-left"></i></span>  Volver</a>
                    <button type="submit" class="mm-btn mm-btn-primary">Crear cuenta</button>
                </div>
            </form>
        </div>
    </section>

    <script>
        // // límites de fecha (opcional): impedir fechas futuras y menores de 13 años
        // (function setDateLimits() {
        //     const input = document.getElementById('fechaDeNacimiento');
        //     const today = new Date();
        //     const yyyy = today.getFullYear();
        //     const mm = String(today.getMonth() + 1).padStart(2, '0');
        //     const dd = String(today.getDate()).padStart(2, '0');
        //     input.max = `${yyyy}-${mm}-${dd}`;
        //
        //     const minAge = 13;
        //     input.min = `${yyyy - 120}-01-01`;   // edad mínima razonable
        //     // Si querés forzar >=13:
        //     // input.max = `${yyyy - minAge}-${mm}-${dd}`;
        // })();

        // envío
        document.getElementById('form-usuario').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validación Bootstrap
            const form = e.currentTarget;
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }

            const data = {
                nombre: document.getElementById('nombre').value.trim(),
                apellido: document.getElementById('apellido').value.trim(),
                // LocalDate en ISO "yyyy-MM-dd"
                fechaDeNacimiento: document.getElementById('fechaDeNacimiento').value,
                // Si tu backend espera rol por id:
                rolId: parseInt(document.getElementById('rolId').value, 10)
                // Si en cambio espera rol por nombre: rol: document.getElementById('rolId').selectedOptions[0].text
            };

            try {
                const resp = await fetch('/api/usuarios', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!resp.ok) {
                    const msg = await resp.text();
                    alert('Error al crear usuario: ' + msg);
                    return;
                }

                // éxito
                alert('Usuario creado con éxito');
                form.reset();
                form.classList.remove('was-validated');
                // redirigí si querés:
                // window.location.href = '/login.html';
            } catch (err) {
                console.error(err);
                alert('No se pudo conectar con el servidor.');
            }
        });
    </script>

</body>
</html>