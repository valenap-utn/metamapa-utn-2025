<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Hecho</title>

    <link rel="icon" th:href="@{/components/logo-ico.png}">

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@600;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link th:href="@{/css/styles-subir-hecho.css}" rel="stylesheet">
</head>
<body>

<section class="mm-form-wrap">
    <div class="mm-card">
        <h1 id="hTitulo" class="mm-form-title" th:text="${hecho.getTitulo() }">Hecho</h1>
        <!--            <p id="hBajada" class="mm-form-sub" th:text="${hecho.getDescripcion() != null ? hecho.getDescripcion() : 'Sin Descripcion' }">Descripción breve del hecho</p>-->
        <span id="hId" style="display:none;" th:text="${hecho.getId()}" ></span>
        <!-- Detalles del Hecho -->
        <div class="row g-3 mb-4">
            <span style="display: none;" id="hechoId" th:text="${hecho.id}"></span>
            <div class="col-12 col-md-6">
                <small class="mm-label d-block">Categoría</small>
                <span id="hCategoria" th:text="${hecho.getCategoria() != null ? hecho.getCategoria().getNombre() : -'-'}">-</span>
            </div>

            <div class="col-12 col-md-6">
                <small class="mm-label d-block">Aconteció</small>
                <span id="hFecha" th:text="${hecho.getFechaAcontecimiento().getDayOfMonth() + '/'+ hecho.getFechaAcontecimiento().getMonthValue() + '/' + hecho.getFechaAcontecimiento().getYear()}">-</span>
            </div>

            <div class="col-12 col-md-6">
                <small class="mm-label d-block">Fecha de carga</small>
                <span id="hFechaCarga" th:text="${hecho.getFechaCarga().getDayOfMonth() + '/'+ hecho.getFechaCarga().getMonthValue() + '/' + hecho.getFechaCarga().getYear()}">-</span>
            </div>

            <div class="col-12 col-md-6">
                <small class="mm-label d-block">Origen</small>
                <span id="hOrigen" th:text="${hecho.getOrigen() != null ? hecho.getOrigen().getTipo() : '—'}">—</span>
            </div>
        </div>

        <!-- Contenido multimedia del Hecho -->
        <div id="mediaWrap" class="mm-media mb-4" aria-label="Contenido multimedia del hecho">
            <div th:if="${hecho.contenidoMultimedia != null and hecho.contenidoMultimedia.getEsVideo()}" class="ratio ratio-16x9"><iframe th:src="${hecho.contenidoMultimedia.path}" allowfullscreen></iframe></div>
            <img th:if="${hecho.contenidoMultimedia != null and !hecho.contenidoMultimedia.getEsVideo()}" th:src="${hecho.contenidoMultimedia.path}" alt="Imagen del hecho"/>
        </div>

        <!-- Ubicación -->
        <div class="row g-3 mb-3">
            <div class="col-12 col-sm-6 col-lg-3">
                <small class="mm-label d-block">Latitud</small>
                <span id="hLat" th:text="${hecho.ubicacion == null ? null : hecho.ubicacion.latitud}">-</span>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <small class="mm-label d-block">Longitud</small>
                <span id="hLong" th:text="${hecho.ubicacion == null ? null : hecho.ubicacion.longitud}">-</span>
            </div>
        </div>

        <div id="mapDetalle" class="mb-3" aria-label="Mapa ubicación del hecho"></div>

        <div class="mb-4">
            <h2 class="h5 mm-label mb-2">Descripción</h2>
            <p id="hDescripcion" class="mb-0" th:text="${hecho.getDescripcion() != null ? hecho.getDescripcion() : 'No hay Descripción' }">-</p>
        </div>

        <!-- Creador -->
        <div class="mb-4">
            <h2 class="h6 mm-label mb-1">Creado por</h2>
            <div id="hCreador" th:text="${hecho.usuario != null ? hecho.usuario.nombre + ' ' + (hecho.usuario.apellido != null ? hecho.usuario.apellido : ' ') + ' ・ ' + hecho.usuario.email  : 'Anonimo'}">-</div>
            <div id="hRoles" class="mt-1 d-flex flex-wrap gap-2"></div>
        </div>

        <!-- Etiquetas -->
        <div class="mb-4">
            <h2 class="h6 mm-label mb-1">Etiquetas relacionadas</h2>
            <ul id="hTags" class="mm-tags list-unstyled d-flex flex-wrap gap-2 mb-0">
                <li th:each=" etiqueta : ${hecho.getEtiquetas()}" th:text="${etiqueta}"></li>
            </ul>
        </div>

        <div class="mm-actions">
            <a th:with="baseUrl=(${ urlColeccion == null || urlColeccion.equals('')}  ? '/hechos/nav-hechos' : ${urlColeccion}  )" th:href="@{${baseUrl}}" class="mm-btn mm-btn-ghost"><span class="arrow"><i class="fa-solid fa-arrow-left"></i></span> Volver</a>
            <button class="mm-btn mm-btn-primary" data-bs-toggle="modal" data-bs-target="#modalSolicitud">
                Solicitar Eliminación
            </button>


            <!--<a href="#" type="submit" class="mm-btn mm-btn-primary">Solicitar Eliminación</a>-->
        </div>

    </div>
</section>

<!-- Modal -->
<div class="modal fade" id="modalSolicitud" tabindex="-1" aria-labelledby="modalSolicitudLabel" aria-describedby="modalSolicitudDesc" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content mm-modal" role="dialog" aria-modal="true">

            <!-- Encabezado -->
            <div class="modal-header">
                <h5 class="modal-title" id="modalSolicitudLabel">Solicitud de eliminacion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <form method="post" th:with="baseUrl=('/hechos/'+ ${hecho.id + '/solicitud-eliminacion'})" th:action="@{${baseUrl}}" >
                <!-- Cuerpo -->
                <div class="modal-body">
                    <p id="modalSolicitudDesc" class="mb-2">Explicanos por qué crees que este hecho debe eliminarse de MetaMapa.</p>
                    <label for="justificacion" class="form-label">Justificación</label>
<!--                    <textarea id="justificacion" class="form-control" rows="6" aria-describedby="just-counter" placeholder="Minimo 500 caracteres..." name="justificacion"></textarea>-->
                    <textarea id="justificacion" class="form-control" rows="6"
                              aria-describedby="just-counter"
                              th:placeholder="${#authorization.expr('isAuthenticated()')} ?
                          'Comentanos la razón por la que queres eliminar este hecho.…' :
                          'Mínimo 500 caracteres...'" name="justificacion" ></textarea>

                    <div id="just-counter"
                         class="form-text"
                         th:attr="data-min=${#authorization.expr('isAuthenticated()')} ? 0 : 500"
                         th:text="${#authorization.expr('isAuthenticated()')} ? ' ' : '0 / 500'">
                        0 / 500
                    </div>

                    <input style="display: none;" type="text" name="urlColeccion" th:value="${urlColeccion}">
                </div>

                <!-- Pie -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary mm-btn-primary" id="btn-enviar" disabled> Enviar solicitud</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>-->
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script type="module" th:src="@{/js/hecho-completo.js}"></script>
</body>
</html>
