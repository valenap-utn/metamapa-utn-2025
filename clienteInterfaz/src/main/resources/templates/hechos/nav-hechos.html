<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout('Hechos', ~{::link}, ~{::section})}">
<head>
    <link th:href="@{/css/styles-commons.css}" rel="stylesheet">
    <link th:href="@{/css/styles-nav-hechos.css}" rel="stylesheet">
</head>
<body>

<!--    <div class="d-flex justify-content-center flex-column align-items-center vh-100">-->
<!--<div class="container py-5">-->
<section>
    <form th:with="baseUrl=(${urlColeccion} != null ? ${urlColeccion} : '/hechos/nav-hechos')" th:action="@{${baseUrl}}" th:object="${filtros}" method="post" novalidate>
        <!-- Modo de Navegación -->
        <h3 class="sub-title text-center mb-4">Modo de Navegación</h3>
        <div class="d-flex justify-content-center gap-4 mb-4" role="radiogroup"
             aria-labelledby="titulo-modo">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="modoIrrestricto"
                       th:checked="${!filtros.curada}" aria-label="Modo de navegación irrestricto" name="modo"/>
                <label class="form-check-label" for="modoIrrestricto">Irrestricto</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="modoCurado"
                       aria-label="Modo de navegación curado" th:checked="${!filtros.curada}" th:field="*{curada}"/>
                <label class="form-check-label" for="modoCurado">Curado</label>
            </div>
        </div>

        <!-- Aplicar Filtros -->
        <h2 class="title-main text-center mb-3">Aplicar Filtros</h2>

        <div class="mm-filters mb-3">
            <!-- Esenciales -->
            <div class="mm-filters__row">
                <div class="form-group col-cat">
                    <label for="fCategoria" class="form-label">Categoría</label>
                    <select id="fCategoria" class="form-select chip select-categoria"
                            aria-label="Filtrar por categoría" th:field="*{categoria}">
                        <option value="">Categoría</option>
                        <option value="EventoSanitario">Evento sanitario</option>
                        <option value="Contaminación">Contaminación</option>
                        <option value="Derrame">Derrame</option>
                    </select>
                </div>

                <div class="form-group col-acon-des">
                    <label for="fAcontDesde" class="form-label">Fecha Del Acontecimiento desde</label>
                    <input id="fAcontDesde" type="datetime-local" class="form-control chip style-ap-filtros"
                           placeholder="Fecha desde" aria-label="Filtrar desde fecha" th:field="*{fecha_acontecimiento_desde}" />
                </div>

                <div class="form-group col-acon-des">
                    <label for="fAcontHasta" class="form-label">Fecha Del Acontecimiento hasta</label>
                    <input id="fAcontHasta" type="datetime-local" class="form-control chip style-ap-filtros"
                           placeholder="Fecha hasta" aria-label="Filtrar hasta fecha" th:field="*{fecha_acontecimiento_hasta}" />
                </div>
            </div>

            <!-- Avanzados plegados -->
            <details class="mm-adv mb-3">
                <summary>Más filtros</summary>
                <div class="mm-adv__body">
                    <div class="mm-adv__grid">
                        <div class="form-group col-search">
                            <label for="fProvincia" class="form-label">Buscar por provincia</label>

                            <input id="fProvincia" type="text"
                                   class="form-control style-ap-filtros mm-kw-input"
                                   placeholder="Ej: Buenos Aires"
                                   th:field="*{provincia}"
                                   style="box-shadow: var(--shadow-sm);">

                            <div id="kwChipsProvincia" class="mm-chips" aria-live="polite"></div>
                        </div>
                        <div class="form-group col-search">
                            <label for="fMunicipio" class="form-label">Buscar por Municipio</label>

                            <input id="fMunicipio" type="text"
                                   class="form-control style-ap-filtros mm-kw-input"
                                   placeholder="Ej: La Matanza"
                                   style="box-shadow: var(--shadow-sm);" th:field="*{municipio}">
                            <div id="kwChipsMunicipio" class="mm-chips" aria-live="polite"></div>
                        </div>
                        <div class="form-group col-search">
                            <label for="fDepartamento" class="form-label">Buscar por Departamento</label>

                            <input id="fDepartamento" type="text"
                                   class="form-control style-ap-filtros mm-kw-input"
                                   placeholder="Ej: Vicente Lopéz"
                                   th:field="*{departamento}"
                                   style="box-shadow: var(--shadow-sm);">

                            <div id="kwChipsDepartamento" class="mm-chips" aria-live="polite"></div>
                        </div>

                        <div class="form-group col-crea-des">
                            <label for="fCreacionDesde" class="form-label">Creación desde</label>
                            <input id="fCreacionDesde" type="datetime-local"
                                   class="form-control chip style-ap-filtros" th:field="*{fecha_reporte_desde}">
                        </div>

                        <div class="form-group col-crea-has">
                            <label for="fCreacionHasta" class="form-label">Creación hasta</label>
                            <input id="fCreacionHasta" type="datetime-local"
                                   class="form-control chip style-ap-filtros" th:field="*{fecha_reporte_hasta}">
                        </div>
                        <div class="form-group col-crea-has">
                            <label for="fPaginado" class="form-label">Número de página</label>
                            <input id="fPaginado" type="number" min="0"
                                   class="form-control chip style-ap-filtros" th:field="*{nroPagina}">
                        </div>
                    </div>
                </div>
            </details>

            <!-- Aplicar || Limpiar filtros -->
            <div class="mm-filters__actions">
                <button id="btnAplicar" class="btn btn-ap-filter" type="submit">Aplicar filtros</button>
                <button id="btnLimpiar" class="btn btn-clear-filter" type="reset">Limpiar</button>
            </div>

        </div>
    </form>



    <!-- Imple. Mapa -->
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div id="map" aria-label="Mapa interactivo con los resultados filtrados"></div>
            <div id="resultInfo" class="mt-2 text-muted small" aria-live="polite"></div>
        </div>
    </div>

    <div class="text-center mt-4">
        <a th:with="baseUrl=(${urlColeccion} != null ? '/colecciones' : '/main-gral')" th:href="@{${baseUrl}}">
            <button class="btn btn-ap-filter" aria-label="Volver a la página principal">
                Volver atrás
            </button>
        </a>
    </div>
    <!--</div>-->

    <!-- Modal de Solicitud (igual al de hecho-completo.html) -->
    <div class="modal fade" id="modalSolicitud" tabindex="-1" aria-labelledby="modalSolicitudLabel"
         aria-describedby="modalSolicitudDesc" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content mm-modal" role="dialog" aria-modal="true">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalSolicitudLabel">Solicitud de eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p id="modalSolicitudDesc" class="mb-2">Explicanos por qué creés que este hecho
                        debe eliminarse de MetaMapa.</p>
                    <label for="justificacion" class="form-label">Justificación</label>
                    <textarea id="justificacion" class="form-control" rows="6"
                              aria-describedby="just-counter"
                              placeholder="Mínimo 500 caracteres..."></textarea>
                    <div id="just-counter" class="form-text">0 / 500</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="button" class="btn btn-primary mm-btn-primary" id="btn-enviar" disabled>
                        Enviar solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="conjuntoDeHechosMapa" style="display: none;">
        <div class="datosHecho"  th:each="hecho, indiceHecho : ${hechos}">
            <span class="idHecho" th:text="${hecho.getId()}"></span>
            <span class="tituloHecho" th:text="${hecho.titulo}"></span>
            <span class="latitudHecho" th:text="${hecho.ubicacion != null ? hecho.ubicacion.latitud : null}"></span>
            <span class="longitudHecho" th:text="${hecho.ubicacion != null ? hecho.ubicacion.longitud : null}"></span>
            <span class="categoriaHecho" th:text="${hecho.categoria.nombre}"></span>
            <span class="fechaHecho" th:text="${hecho.fechaAcontecimiento}"></span>
            <span class="urlHecho" th:text="@{/hechos/{id}(id=${hecho.getId()}, urlColeccion=${urlColeccion})}"></span>
        </div>
    </div>

    <!-- Mockeo de datos para prueba -->
    <script type="module" th:src="@{/js/nav-hechos.js}"></script>

    <!-- Bootstrap JS -->
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>

    <script>
        document.querySelector('.mm-adv')?.addEventListener('toggle', e => {
            if (e.target.open) e.target.scrollIntoView({block: 'nearest', behavior: 'smooth'});
        });
    </script>

</section>

</body>
</html>