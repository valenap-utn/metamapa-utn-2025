<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/layout :: layout('Colecciones', ~{::link}, ~{::section})}">
<head>
    <link rel="stylesheet" th:href="@{/css/styles-colecciones.css}">
</head>
<body class="body-metamapa">
    <section>
        <main class="container py-5">
            <header class="mb-4 text-center">
                <h1 class="title-main" style="padding-top: 60px;">Colecciones</h1>
            </header>

            <!-- GRID de colecciones -->
            <section id="coleccionesList" class="mm-collections-grid">
                <article class="mm-collection-card" th:each="coleccion : ${colecciones}">
                    <div class="mm-card-header">
                        <img class="mm-card-icon" src="../components/sachet_7909215.png" alt="">
                        <div>
                            <h3 class="mm-card-title" th:text="${coleccion.titulo}"></h3>
                            <p class="mm-card-sub" th:text="${coleccion.descripcion != null ? coleccion.descripcion : 'Colección sin descripción.' }"></p>
                        </div>
                    </div>
                        <ul class="mm-meta">
                            <li th:each="filtro : ${coleccion.criterios}" th:if="${ filtro.getTipo().equals('FECHACARGA') or filtro.getTipo().equals('FECHAACONTECIMENTO')}" class="mm-chip">Desde: <span th:text="${ filtro.fechaAcontecimientoInicial != null ? filtro.fechaAcontecimientoInicial : (filtro.fechaCargaInicial != null ? filtro.fechaCargaInicial : '--')}"></span></li>
                            <li th:each="filtro : ${coleccion.criterios}" th:if="${ filtro.getTipo().equals('FECHACARGA') or filtro.getTipo().equals('FECHAACONTECIMENTO')}" class="mm-chip">Hasta: <span th:text="${ filtro.fechaAcontecimientoFinal != null ? filtro.fechaAcontecimientoFinal : (filtro.fechaCargaFinal != null ? filtro.fechaCargaFinal : '--')}"></span></li>
                            <li th:each="filtro : ${coleccion.criterios}" class="mm-chip" th:if="${filtro.getTipo().equalsIgnoreCase('UBICACIONPROVINCIA')}"  th:text="${filtro.provincia}"></li>
                            <li th:each="filtro : ${coleccion.criterios}" class="mm-chip" th:if="${filtro.getTipo().equalsIgnoreCase('UBICACIONMUNICIPIO')}"  th:text="${filtro.municipio}"></li>
                            <li th:each="filtro : ${coleccion.criterios}" class="mm-chip" th:if="${filtro.getTipo().equalsIgnoreCase('UBICACIONDEPARTAMENTO')}"  th:text="${filtro.departamento}"></li>
                            <li th:each="filtro : ${coleccion.criterios}" class="mm-chip" th:if="${filtro.getTipo().equalsIgnoreCase('CATEGORIA')}" th:text="${filtro.categoria}"></li>
                        </ul>





                    <div class="accordion mm-accordion" th:id="${'acc-'+ coleccion.id}">
                        <div class="accordion-item">
                            <h2 class="accordion-header" th:id="${'h-' + coleccion.id}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" th:data-bs-target="${'#c-'+coleccion.id}">
                                    Fuentes
                                </button>
                            </h2>
                            <div th:id="${'c-' + coleccion.id}" class="accordion-collapse collapse" th:aria-labelledby="${'h-' + coleccion.id}" th:data-bs-parent="${'#acc-' + coleccion.id}">
                                <div class="accordion-body">
                                    <ul class="mm-sources">
                                        <li th:each="fuente : ${coleccion.fuentes}">
                                            <span th:text="${fuente.tipoOrigen}"></span>
                                            <a class="mm-link" th:href="${fuente.url}" target="_blank" rel="noreferrer" th:text="${fuente.url}"></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mm-card-actions d-flex justify-content-between">
                        <a class="mm-btn mm-btn-primary" th:href="@{/colecciones/{id}/nav-hechos(id=${coleccion.getId()})}">Ver colección</a>

                        <div class="d-flex gap-2">
                            <form sec:authorize="hasRole('ADMINISTRADOR')" th:action="@{/admin/eliminar-coleccion/{id}/eliminar (id=${coleccion.getId()})}" method="post"
                                  onsubmit="if(confirm('¿Estás seguro que querés borrar la colección?')){ return true; } else { window.location.href='/colecciones'; return false; }"
                                  style="display:inline;">
                                <button class="mm-btn mm-btn-ghost" type="submit">
                                    <i class="fa-solid fa-trash-can" aria-hidden="true"></i>
                                </button>
                            </form>
                            <a class="mm-btn mm-btn-ghost" sec:authorize="hasRole('ADMINISTRADOR')"
                               th:href="@{/admin/modificar-coleccion/{id}/editar(id=${coleccion.id})}">
                                <i class="fa-solid fa-pencil" aria-hidden="true"></i>
                            </a>

                            <a class="mm-btn mm-btn-ghost" href="#" th:attr="onclick=|accionCompartir( '${coleccion.titulo}', '${coleccion.getId()}' )|" >
                                <i class="fa-solid fa-share-nodes"></i>
                            </a>
                        </div>
                    </div>
                </article>
            </section>
    <!--        <section id="coleccionesGrid" class="mm-collections-grid"></section>-->
        </main>

        <div class="d-flex justify-content-center flex-column align-items-center h-100">
            <a th:href="@{/index.html}">
                <a class="mm-btn mm-btn-primary btn-lg mb-3" style="font-weight: 500" aria-label="Volver al inicio" th:href="@{/main-gral}">Volver atrás</a>
            </a>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

        <script th:src="@{/js/colecciones.js}"></script>

    </section>
</body>
</html>